# Bitwise Operation

## 1、位运算概述

+ 位运算是对整数在存储器中二进制位模式进行操作的运算，它直接对整数的二进制位进行操作,效率很高,用于表示和处理数字

+ 位运算在Java中使用不太广泛:

  + 可读性较差：位运算操作的可读性和理解难度较高
  + 难以调试：由于涉及到二进制运算，不太容易直接看出运算结果,调试也比较困难
  + 运算对象局限于整数
  + 误操作风险高：位运算如果用得不当，很容易产生意外的结果,导致逻辑错误
  + 舍弃精度：位运算难以进行高精度计算，很容易丢失精度
  + 可移植性差：不同计算机平台上的整数在内存中的存储方式不同，位运算的结果也会有差异,可移植性较差

  总体来说,位运算虽然运算效率高，但可读性、可调试性和可移植性都较差，也无法处理浮点数等其他数据类型。除非在要求高性能和节省资源的场景，才会考虑使用位运算。而在一般的开发场景下更加推荐使用普通的算数运算来完成计算任务

## 2、位运算操作

+ &：按位与

+ |：按位或

+ ~：按位非

+ ^：按位异或

+ <<：左位移运算符

  + 将运算符左边的数的各二进制位全部左移若干位，由<<右边的数指定左移的位数，高位丢弃，低位补0

  > 根据Java规范，右操作数b的取值范围是0~31，如果b的值超出了这个范围，Java将会自动将其转换为模32的余数。因此，使用大于等于32的右操作数会产生相同的结果，这是因为超出32位的位移数是无法影响结果的。例如，对于int类型的左操作数a，如果右操作数b为17，则a<<17与a<<49会产生相同的结果，因为49对32取余数的结果为17，所以右操作数被自动转换为17。因此，程序中为了避免不必要的源代码错误，通常会在位移操作中使用表达式b%32来代替b（包含>>、>>>）

  

+ \>>：右位移运算符

  + 将运算符左边的数的各二进制位全部左移若干位，由<<右边的数指定左移的位数，高位丢弃，低位补 0

+ \>>>：无符号右移运算符

  + 将所有的二进制位按值向右移动若干位，低位直接舍弃，跟正负无关，高位补 0 

  > 对左、右移的理解，需要了解：
  >
  > [原码、反码、补码 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/118432554)
  >
  > [原码、反码、补码的产生、应用以及优缺点有哪些？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/20159860/answer/71256667)

## 3、常用操作

+ 常见计算法则

```java
x ^ 0 = x      x & 0 = 0      x | 0 = x
x ^ 1 = ~x     x & 1 = x      x | 1 = 1
x ^ x = 0      x & x = x      x | x = x
```

+ m*2^n = m << n
+ 判断奇偶性

```java
(n & 1) == 1 ? "奇数" : "偶数"
```

+ 利用或操作 | 和空格将英文字符转换为小写

```java
('a' | ' ') = 'a'
('A' | ' ') = 'a'
```

+ 利用与操作 & 和下划线将英文字符转换为大写

```java
('b' & '_') = 'B'
('B' & '_') = 'B'
```

+ 利用异或操作 ^ 和空格进行英文字符大小写互换

```java
('d' ^ ' ') = 'D'
('D' ^ ' ') = 'd'
```

+ 判断两个数是否异号

```java
int x = -1, y = 2;
boolean f = ((x ^ y) < 0); // true

int x = 3, y = 2;
boolean f = ((x ^ y) < 0); // false
```

+ 不用临时变量交换两个数

```java
int a = 1, b = 2;
a ^= b;
b ^= a;
a ^= b;
```
> 理解：a^b储存了将a、b不一样的位置变为了1，不一样的为0，考虑到x^0 = x，x^1 = ~x，当a^(a^b)，相当于把a中与b一样的位保留原状，将与b不一样的位取反，进而得到b

+ 加一

```java
int n = 1;
n = -~n;
```

+ 减一

```java
int n = 2;
n = ~-n;
```

+ 取绝对值

```java
|a| = (a^(a>>31))-(a>>31)
```

+ 变换符号，正变负，负变正

```java
-n = ~n + 1
-n = ~(n + 1)   
```

+ 判断一个数num是不是 2 的幂

```java
boolean isPowerOfTwo = n&(n-1) == 0
```

+ 取两个数的最大值（某些机器上，效率比a>b ? a:b高）

```java
b&((a-b)>>31) | a&(~(a-b)>>31)
```

+ 取两个数的最小值（某些机器上，效率比a>b ? b:a高）

```java
a&((a-b)>>31) | b&(~(a-b)>>31))
```

## 参考：

[(88条消息) 一篇搞定位运算——java位运算详解_青癯的博客-CSDN博客](https://blog.csdn.net/qq_42265220/article/details/118386893)

[Java 位运算超全面总结（以及Koltin） - 掘金 (juejin.cn)](https://juejin.cn/post/6844903841293402126)
